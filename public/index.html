<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="icon" href="/assets/favicon.ico"/>
    <title>Docx viewer</title>
    <style>
        body {
            margin: 0; /* Reset default margin */
        }

        iframe {
            display: block; /* iframes are inline by default */
            background: #000;
            border: none; /* Reset default border */
            height: 100vh; /* Viewport-relative units */
            width: 100vw;
        }
    </style>
    <script src="/assets/lodash.min.js"></script>
    <script src="/socket.io.local/socket.io.js"></script>
    <script type="text/javascript">
        function onLoadEvent() {
            const public_url = "<%= PUBLIC_URL %>";
            const file_name = "<%= GENERATED_FILENAME %>";
            const node_env = "<%= NODE_ENV %>";
            const debounce_time = +"<%= DEBOUNCE_TIME %>";
            const viewer = "<%= VIEWER %>";
            const socket = io();
            const file_public_url = public_url + "/static/" + file_name;
            if (node_env === 'production') {
                console.log('file_public_url', file_public_url);
                console.log = function () {
                };
            }
            let iframe_src;
            if (viewer === 'GOOGLE') {
                iframe_src = "https://docs.google.com/gview?embedded=true&url=" + file_public_url;
            } else {
                iframe_src = "https://view.officeapps.live.com/op/embed.aspx?src=" + file_public_url;
            }
            // load iframe on page load
            document.getElementById('docx-viewer-iframe').src = iframe_src + "&__version=" + new Date().getTime();
            // reloading the iframe when the file is updated
            socket.on('reload', _.debounce(function () {
                document.getElementById('docx-viewer-iframe').src = iframe_src + "&__version=" + new Date().getTime();
                console.log('reload event received');
            }, debounce_time, {
                leading: false,
                trailing: true,
            }));
        }
    </script>
</head>
<body onload="onLoadEvent()">
<iframe id="docx-viewer-iframe">
</iframe>
</body>
</html>
